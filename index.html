<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…Ø±Ø­Ù„Ù‡ Û² â€” Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø§Ø¹Ø¶Ø§ Ø¯Ø± Ú†Ù†Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡</title>
<style>
  :root{
    --bg1:#041426; --bg2:#071a2f;
    --panel:#0b2430; --accent:#66fff0; --warm:#ffd36b;
    --good:#4fe09a; --bad:#ff6b6b; --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:28px; font-family: Vazirmatn, "Segoe UI", Roboto, Arial, system-ui;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(102,255,240,0.04), transparent),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#e8fbff; text-align:center; min-height:100vh;
  }
  h1{ margin:6px 0 12px; font-size:22px; letter-spacing:0.6px; color:var(--accent); }
  .subtitle{ color:#bffcffaa; margin-bottom:8px; }

  .top-row{ display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
  #statusBox{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04)); padding:8px 12px; border-radius:10px; font-weight:800; color:var(--accent); border:1px solid rgba(102,255,240,0.06); }

  .board{ display:flex; gap:18px; justify-content:center; align-items:flex-start; flex-wrap:wrap; margin-top:6px; padding:6px; }

  .set-box{
    width:320px; min-height:150px; padding:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.06));
    border:1px solid rgba(255,255,255,0.03); position:relative; box-shadow:0 12px 40px rgba(0,0,0,0.55);
    transition:transform .2s cubic-bezier(.2,.9,.2,1), box-shadow .22s ease;
  }
  .set-box.highlight{ transform:translateY(-6px) scale(1.01); box-shadow:0 20px 60px rgba(34,160,220,0.06); }
  .set-title{ font-weight:900; font-size:18px; margin-bottom:6px; color:#cfefff; display:flex; justify-content:space-between; align-items:center; }
  .set-note{ font-size:13px; color:#bfeaff; opacity:0.95; margin-bottom:8px; text-align:right; }
  .set-contents{ min-height:72px; display:flex; gap:8px; flex-wrap:wrap; align-items:flex-start; padding:6px; border-radius:8px; background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(255,255,255,0.01)); }

  .brace-placeholder{ font-weight:900; color:rgba(255,200,120,0.08); }

  .tray-area{ width:100%; margin-top:18px; display:flex; justify-content:center; }
  .cards{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; max-width:980px; }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    padding:12px 16px; border-radius:28px; cursor:grab; user-select:none;
    border:1px solid rgba(255,255,255,0.03); box-shadow:0 10px 30px rgba(0,0,0,0.45);
    font-size:20px; min-width:54px; text-align:center; transition:transform .12s ease;
    color:#e9fbff; font-weight:900;
  }
  .card:active{ cursor:grabbing; transform:scale(.98); }
  .card.ghost{ opacity:.45; transform:scale(.96); }

  .placed{ background: rgba(255,255,255,0.02); border-radius:10px; padding:8px 10px; display:inline-block; margin:6px 6px 0 0; cursor:grab; font-weight:800; color:#e8ffff; border:1px solid rgba(102,255,240,0.04); }
  .placed.dragging{ opacity:.5; }

  .poof{ position:absolute; width:26px; height:26px; border-radius:100%; pointer-events:none; transform:scale(0); opacity:0; transition:all .36s ease; }

  @keyframes toss{ 0%{ transform: translateY(0) rotate(0) scale(1); opacity:1 } 40%{ transform: translateY(-26px) rotate(-12deg) scale(1.02); opacity:1 } 100%{ transform: translateY(160px) rotate(24deg) scale(.6); opacity:0 } }
  .toss-anim{ animation: toss 520ms cubic-bezier(.2,.9,.2,1); }

  @keyframes shakeX{ 0%{transform:none}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-6px)}100%{transform:none} }
  .shake{ animation:shakeX .36s; }

  /* welcome modal + white flash before button */
  #welcome{
    position:fixed; inset:0; display:flex; justify-content:center; align-items:center; z-index:9999;
    background: linear-gradient(180deg, rgba(0,0,0,0.64), rgba(0,0,0,0.55));
  }
  .welcome-card{ background:linear-gradient(180deg,#06182a,#021122); padding:26px 28px; border-radius:14px; text-align:center; width:92%; max-width:720px; box-shadow:0 26px 80px rgba(0,0,0,0.7); color:#e7fbff; border:1px solid rgba(255,255,255,0.03); position:relative; overflow:hidden; }
  .flash-white{ position:absolute; inset:0; background:radial-gradient(circle at 50% 10%, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.12) 6%, rgba(255,255,255,0) 16%); opacity:0; transform:scale(0.8); transition:all .36s ease; pointer-events:none; }
  .flash-in{ opacity:1; transform:scale(1); transition:all .26s ease; }
  .welcome-key{ font-size:48px; margin-bottom:6px; transform:rotate(-8deg); display:inline-block; filter:drop-shadow(0 10px 30px rgba(0,240,255,0.06)); }
  .welcome-title{ font-weight:900; font-size:20px; margin-bottom:8px; color:var(--accent); }
  .welcome-text{ color:#cfeeff; opacity:0.96; margin-bottom:12px; font-size:14px; line-height:1.4; }
  .btn{ display:inline-block; padding:10px 16px; border-radius:12px; font-weight:800; cursor:pointer; border:none; margin:6px; }
  .btn.start{ background:linear-gradient(90deg,#00f6ff,#8ef0c2); color:#023; box-shadow:0 14px 44px rgba(0,240,255,0.06); }
  .btn.later{ background:transparent; color:#9feef8; border:1px solid rgba(159,238,248,0.08); }

  .muted{ color:#9beff6cc; font-size:13px; }
  /* removed footer / reminder as requested */
</style>
</head>
<body>
  <div id="welcome" aria-hidden="false">
    <div class="welcome-card" role="dialog" aria-modal="true">
      <div class="flash-white" id="flash"></div>
      <div class="welcome-key">ğŸ”¬</div>
      <div class="welcome-title">Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø§Ø¹Ø¶Ø§ Ø¯Ø± Ú†Ù†Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡</div>
      <div class="welcome-text">Ø¯Ø± Ø§ÛŒÙ† Ø¢Ø²Ù…Ø§ÛŒØ´ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù‡Ù…â€ŒØ²Ù…Ø§Ù† Ø¯Ø± Ú†Ù†Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¹Ø¶Ùˆ Ø¨Ø§Ø´Ø¯. Ú©Ø§Ø±Øª Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø± Ùˆ Ø¯Ø± Ù‡Ø± Ø®Ø§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒØ§Ø´ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø§Ø³Øª Ø¨ÛŒÙ†Ø¯Ø§Ø². Ø¨Ø§Ø²ÛŒ ØªØ¬Ø±Ø¨Ù‡â€ŒÙ…Ø­ÙˆØ± Ø§Ø³ØªØ› Ù†Ú¯Ø±Ø§Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ Ù…ØªÙ†ÛŒ Ø³Ø®Øª Ù†Ø¨Ø§Ø´.</div>
      <!-- no rules / no examples here (removed as requested) -->
      <div>
        <button class="btn start" id="btnStart" style="visibility:hidden; transform:translateY(8px) scale(.98);">Ø´Ø±ÙˆØ¹ Ú©Ù†</button>
        <button class="btn later" id="btnLater" style="visibility:hidden; transform:translateY(8px) scale(.98);">Ø¨Ø¹Ø¯Ø§Ù‹</button>
      </div>
    </div>
  </div>

  <h1>Ù…Ø±Ø­Ù„Ù‡ Û² â€” Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø§Ø¹Ø¶Ø§ Ø¯Ø± Ú†Ù†Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡</h1>
  <div class="subtitle">Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ú©Ø´ Ùˆ Ø¯Ø± Ù‡Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ú©Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒÙ Ø¹Ø¯Ø¯ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø§Ø³Øª Ø±Ù‡Ø§ Ú©Ù†.</div>

  <div class="top-row">
    <div id="statusBox">ÙˆØ¶Ø¹ÛŒØª: <span id="statusText">Ø¢Ù…Ø§Ø¯Ù‡</span></div>
  </div>

  <div class="board" aria-live="polite">
    <div class="set-box" data-set="A" id="setA">
      <div class="set-title">A <span class="brace-placeholder"></span></div>
      <div class="set-note">A: Ø§Ø¹Ø¯Ø§Ø¯ ÙØ±Ø¯</div>
      <div class="set-contents" data-contents="A" aria-label="Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” A"></div>
    </div>

    <div class="set-box" data-set="B" id="setB">
      <div class="set-title">B <span class="brace-placeholder"></span></div>
      <div class="set-note">B: Ø§Ø¹Ø¯Ø§Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û´</div>
      <div class="set-contents" data-contents="B" aria-label="Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B"></div>
    </div>

    <div class="set-box" data-set="C" id="setC">
      <div class="set-title">C <span class="brace-placeholder"></span></div>
      <div class="set-note">C: Ø§Ø¹Ø¯Ø§Ø¯ Ø²ÙˆØ¬</div>
      <div class="set-contents" data-contents="C" aria-label="Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” C"></div>
    </div>
  </div>

  <div class="tray-area" aria-label="Ø³ÛŒÙ†ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§">
    <div class="cards" id="tray">
      <!-- cards (duplicates for 1 and 2 included per earlier request) -->
      <div class="card" draggable="true" data-value="1">Û±</div>
      <div class="card" draggable="true" data-value="2">Û²</div>
      <div class="card" draggable="true" data-value="3">Û³</div>
      <div class="card" draggable="true" data-value="4">Û´</div>
      <div class="card" draggable="true" data-value="5">Ûµ</div>
      <div class="card" draggable="true" data-value="6">Û¶</div>
      <div class="card" draggable="true" data-value="1">Û±</div>
      <div class="card" draggable="true" data-value="2">Û²</div>
    </div>
  </div>

<script>
/* ---------- Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡ (Ø­Ø§Ù„Øª D/Mode kept) ---------- */
const setsRules = {
  A: v => (v % 2 === 1),   // odd
  B: v => (v < 4),         // less than 4
  C: v => (v % 2 === 0)    // even
};

const tray = document.getElementById('tray');
const boxes = document.querySelectorAll('.set-box');
const statusText = document.getElementById('statusText');
const welcome = document.getElementById('welcome');
const btnStart = document.getElementById('btnStart');
const btnLater = document.getElementById('btnLater');
const flash = document.getElementById('flash');

function uniqueId(prefix='id'){ return prefix + '-' + Math.floor(Math.random()*1000000) + '-' + Date.now().toString(36); }

function setStatus(text){ statusText.textContent = text; }

/* small visual effects */
function poofAt(box){
  const p = document.createElement('div');
  p.className = 'poof';
  p.style.background = 'radial-gradient(circle at 30% 30%, rgba(102,255,240,0.95), rgba(34,200,180,0.72))';
  box.appendChild(p);
  p.style.left = '50%'; p.style.top = '34%'; p.style.transform = 'translate(-50%,-50%) scale(0)';
  setTimeout(()=>{ p.style.transform = 'translate(-50%,-50%) scale(1)'; p.style.opacity = '1'; }, 30);
  setTimeout(()=>{ p.style.transform = 'translate(-50%,-50%) scale(1.6)'; p.style.opacity = '0'; }, 240);
  setTimeout(()=> p.remove(), 520);
}
function flashSet(box){
  box.classList.add('highlight');
  setTimeout(()=> box.classList.remove('highlight'), 520);
}

/* create placed copy element */
function createPlacedElement(value, setName){
  const d = document.createElement('div');
  d.className = 'placed';
  d.textContent = value;
  d.dataset.value = value;
  d.dataset.set = setName;
  d.id = uniqueId('placed');
  makePlacedDraggable(d);
  return d;
}

/* tray originals remain; placing creates copies so a card can be in multiple sets */

/* make tray card draggable */
function makeTrayCardDraggable(el){
  if(!el.id) el.id = uniqueId('tray');
  el.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('value', el.dataset.value);
    e.dataTransfer.setData('origin', 'tray');
    e.dataTransfer.setData('dragId', el.id);
    el.classList.add('ghost');
    setStatus('Ø¯Ø± Ø­Ø§Ù„ Ú©Ø´ÛŒØ¯Ù† Ú©Ø§Ø±Øª...');
  });
  el.addEventListener('dragend', e=>{
    el.classList.remove('ghost');
    setStatus('Ø¢Ù…Ø§Ø¯Ù‡');
  });
}

/* make placed copy draggable and removable (click to remove) */
function makePlacedDraggable(el){
  el.setAttribute('draggable','true');
  el.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('value', el.dataset.value);
    e.dataTransfer.setData('origin', 'placed');
    e.dataTransfer.setData('dragId', el.id);
    e.dataTransfer.setData('fromSet', el.dataset.set || '');
    el.classList.add('dragging');
    setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ú©Ø§Ø±Øª Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ‡...');
  });
  el.addEventListener('dragend', e=>{
    el.classList.remove('dragging');
    setStatus('Ø¢Ù…Ø§Ø¯Ù‡');
  });
  el.addEventListener('click', ()=>{
    el.style.transition = 'transform .28s ease, opacity .22s ease';
    el.style.transform = 'translateY(8px) scale(.9)';
    el.style.opacity = '0';
    setTimeout(()=> el.remove(), 260);
  });
}

/* set drop handlers */
boxes.forEach(box=>{
  box.addEventListener('dragover', e=> e.preventDefault());
  box.addEventListener('dragenter', e=> box.classList.add('highlight'));
  box.addEventListener('dragleave', e=> box.classList.remove('highlight'));
  box.addEventListener('drop', e=>{
    e.preventDefault();
    box.classList.remove('highlight');
    const value = Number(e.dataTransfer.getData('value'));
    const origin = e.dataTransfer.getData('origin'); // 'tray' or 'placed'
    const dragId = e.dataTransfer.getData('dragId');
    const fromSet = e.dataTransfer.getData('fromSet');
    handleDropToSet({value, origin, dragId, fromSet}, box);
  });
});

/* tray drop: returning a placed card (delete the placed copy) */
tray.addEventListener('dragover', e=> e.preventDefault());
tray.addEventListener('drop', e=>{
  e.preventDefault();
  const origin = e.dataTransfer.getData('origin');
  const dragId = e.dataTransfer.getData('dragId');
  if(origin === 'placed'){
    const placedEl = document.getElementById(dragId);
    if(placedEl){
      placedEl.remove();
      setStatus('Ú©Ø§Ø±Øª Ø¨Ø±Ø¯Ø§Ø´ØªÙ‡ Ø´Ø¯.');
    }
  }
});

/* wrong placement animation (toss + Ã—) */
function animateInvalidPlace(box){
  // small shake
  box.classList.add('shake');
  setTimeout(()=> box.classList.remove('shake'), 360);

  // transient Ã— indicator that tosses down
  const tmp = document.createElement('div');
  tmp.className = 'card toss-anim';
  tmp.textContent = 'âœ–';
  tmp.style.position = 'absolute';
  tmp.style.left = '50%';
  tmp.style.top = '58%';
  tmp.style.transform = 'translate(-50%,-50%)';
  tmp.style.zIndex = 999;
  tmp.style.pointerEvents = 'none';
  tmp.style.background = 'linear-gradient(180deg, rgba(255,90,90,0.12), rgba(255,80,80,0.06))';
  tmp.style.border = '1px solid rgba(255,90,90,0.12)';
  tmp.style.color = '#fff';
  tmp.style.padding = '8px 10px';
  tmp.style.borderRadius = '12px';
  box.appendChild(tmp);
  setTimeout(()=> tmp.remove(), 520);
}

/* main drop logic */
function handleDropToSet(drag, box){
  const setName = box.dataset.set;
  const contentsEl = box.querySelector('.set-contents');
  const value = Number(drag.value);

  // duplicate check in that set
  const existingVals = Array.from(contentsEl.children).map(n => Number(n.dataset.value));
  if(existingVals.includes(value)){
    animateInvalidPlace(box);
    setStatus('Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ‡.');
    return;
  }

  // membership check
  const rule = setsRules[setName];
  const ok = rule(value);
  if(!ok){
    animateInvalidPlace(box);
    setStatus('Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¹Ø¯Ø¯ Ù…Ù†Ø§Ø³Ø¨ Ù†ÛŒØ³Øª â€” Ú©Ø§Ø±Øª Ø¨Ù‡ Ø³ÛŒÙ†ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.');
    return;
  }

  // allowed placement
  if(drag.origin === 'tray'){
    // create placed copy
    const placed = createPlacedElement(value, setName);
    contentsEl.appendChild(placed);
    flashSet(box);
    poofAt(box);
    placed.style.transform = 'rotate(-12deg) scale(.98)';
    placed.style.opacity = '0';
    setTimeout(()=>{ placed.style.transition = 'transform .36s cubic-bezier(.2,.9,.2,1), opacity .28s ease'; placed.style.transform = 'none'; placed.style.opacity = '1'; }, 10);
    setStatus(`Ø¹Ø¯Ø¯ ${value} Ø¯Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” ${setName} Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª.`);
    updateBraces(); // update optional visual (if used later)
    return;
  }

  if(drag.origin === 'placed'){
    const orig = document.getElementById(drag.dragId);
    if(!orig){ setStatus('Ù‡ÛŒÚ†â€ŒÚ†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯'); return; }
    const origFrom = drag.fromSet || orig.dataset.set;
    if(origFrom === setName){
      orig.style.visibility = 'visible';
      setStatus('Ø¯Ø± Ù‡Ù…Ø§Ù† Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø±Ù‡Ø§ Ø´Ø¯.');
      return;
    }
    // move element
    orig.remove();
    orig.dataset.set = setName;
    contentsEl.appendChild(orig);
    flashSet(box);
    poofAt(box);
    setStatus(`Ú©Ø§Ø±Øª Ø§Ø² ${origFrom} Ø¨Ù‡ ${setName} Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.`);
    updateBraces();
    return;
  }
}

/* initialize tray draggables */
document.querySelectorAll('#tray .card').forEach(el=>{
  if(!el.id) el.id = uniqueId('tray');
  makeTrayCardDraggable(el);
});

/* welcome modal: white flash then show buttons */
function showStartFlashThenButtons(){
  flash.classList.add('flash-in'); // show white flash
  // after short flash, reveal buttons with small pop
  setTimeout(()=>{
    btnStart.style.visibility = 'visible';
    btnLater.style.visibility = 'visible';
    btnStart.style.transform = 'translateY(0) scale(1)';
    btnLater.style.transform = 'translateY(0) scale(1)';
    btnStart.style.transition = 'all .34s cubic-bezier(.2,.9,.2,1)';
    btnLater.style.transition = 'all .34s cubic-bezier(.2,.9,.2,1)';
  }, 360);
}
document.addEventListener('DOMContentLoaded', ()=> {
  // kick the flash animation a tick after load so user sees it
  setTimeout(()=> showStartFlashThenButtons(), 220);
});

/* welcome controls */
btnStart.addEventListener('click', ()=> hideWelcome());
btnLater.addEventListener('click', ()=> hideWelcome());
function hideWelcome(){
  if(!welcome) return;
  welcome.style.display = 'none';
  setStatus('Ø¢Ù…Ø§Ø¯Ù‡ â€” Ø¨Ø§Ø²ÛŒ Ú©Ù†!');
}

/* keyboard: Esc to close welcome */
document.addEventListener('keydown', e=>{ if(e.key === 'Escape') hideWelcome(); });

/* small helper to update braces (not visible by default, kept if needed) */
function updateBraces(){
  document.querySelectorAll('.set-box').forEach(box=>{
    const list = Array.from(box.querySelectorAll('.set-contents .placed')).map(n => n.dataset.value);
    const ph = box.querySelector('.brace-placeholder');
    if(ph) ph.textContent = list.length ? '{ ' + list.join(' , ') + ' }' : '';
  });
}
const obsCfg = { childList:true, subtree:true };
document.querySelectorAll('.set-contents').forEach(node=>{
  const mo = new MutationObserver(()=> updateBraces());
  mo.observe(node, obsCfg);
});
updateBraces();

/* initial status */
setStatus('Ø¢Ù…Ø§Ø¯Ù‡');
</script>
</body>
</html>
